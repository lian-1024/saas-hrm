import{d as O,ah as h,ab as A,u as e,ai as M,r as N,w as $,a7 as B,j as G,a as U,a4 as b,a5 as d,a6 as l,c as n,a9 as V,F as q,al as D,G as P,af as j}from"./vue-vendor-BX3z0DRI.js";import{_ as z}from"./modal.vue_vue_type_script_setup_true_lang-BGdz2b2r.js";import{u as H}from"./index-BUvr80Hr.js";import{c as J,u as K}from"./index-Dae1U06w.js";import{b as c}from"./message-B_TRrMgK.js";import{E as Q}from"./employee.service-B6FZBlIR.js";import{h as W,F as _,r as X,ag as f,ak as Y,ai as Z}from"./antd-vendor-ChGXved8.js";import{_ as ee}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./axios-vendor-cIIFlI1p.js";import"./lodash-vendor-C1hxrrCz.js";const ae=O({__name:"mass-notification",props:h({employees:{}},{open:{type:Boolean,default:!1},openModifiers:{}}),emits:["update:open"],setup(v){A(s=>({"1b77d3a6":"".concat(e(p).margin,"px"),"84c22ca2":"".concat(e(p).padding,"px"),"7d9d962b":e(p).colorBorder,"3bf43951":"".concat(e(p).borderRadiusLG,"px")}));const u=M(v,"open"),y=v,{token:p}=H(),{isDark:I}=J(),r=N(y.employees);$([()=>y.employees,()=>u.value],([s,a])=>{a&&(r.value=T(s))});const T=s=>s.map(a=>({id:a.id,username:"@".concat(a.username)})),E=s=>{r.value=r.value.filter(a=>a.id!==s)},{t:o}=B(),k=G(()=>[{label:o("common.message.level.notification"),value:c.NOTIFICATION},{label:o("common.message.level.tips"),value:c.TIPS},{label:o("common.message.level.important"),value:c.IMPORTANT},{label:o("common.message.level.urgent"),value:c.URGENT}]),i=U({type:c.NOTIFICATION,content:""}),m=N(),x={type:[{required:!0,message:o("employee.massNotification.rules.messageLevel")}],content:[{required:!0,message:o("employee.massNotification.rules.content")}]},g=()=>{u.value=!1,m.value&&(m.value.resetFields(),r.value=[])},{run:C,loading:S}=K(Q.massNotification,{manual:!0,onSuccess:()=>{W.success(o("employee.messages.massNotificationSuccess"))},onError:({message:s})=>{s.error(s||o("employee.messages.massNotificationError"))},onFinally:()=>{g()}}),F=async()=>{m.value&&await m.value.validate().then(s=>{C({...i,userIds:r.value.map(a=>a.id)})})},w=()=>{g()},L={span:6},R={span:16};return(s,a)=>(d(),b(e(z),{title:e(o)("employee.massNotification.title"),open:u.value,"onUpdate:open":a[2]||(a[2]=t=>u.value=t),"confirm-loading":e(S),onOk:F,onCancel:w,mask:""},{default:l(()=>[n(e(_),{vertical:""},{default:l(()=>[n(e(_),{wrap:"wrap",gap:"small",class:"mass-selected-employee"},{default:l(()=>[(d(!0),V(q,null,D(r.value,t=>(d(),b(e(X),{color:e(I)?"default":"processing",key:t.id,closable:"",onClose:oe=>E(t.id)},{default:l(()=>[P(j(t.username),1)]),_:2},1032,["color","onClose"]))),128))]),_:1})]),_:1}),n(e(f),{rules:x,ref_key:"formRef",ref:m,model:i,"label-col":L,"wrapper-col":R},{default:l(()=>[n(e(f).Item,{label:e(o)("employee.massNotification.messageLevel"),name:"type"},{default:l(()=>[n(e(Y),{value:i.type,"onUpdate:value":a[0]||(a[0]=t=>i.type=t),options:k.value},null,8,["value","options"])]),_:1},8,["label"]),n(e(f).Item,{label:e(o)("employee.massNotification.content"),name:"content"},{default:l(()=>[n(e(Z).TextArea,{value:i.content,"onUpdate:value":a[1]||(a[1]=t=>i.content=t),placeholder:e(o)("employee.massNotification.rules.content")},null,8,["value","placeholder"])]),_:1},8,["label"])]),_:1},8,["model"])]),_:1},8,["title","open","confirm-loading"]))}}),de=ee(ae,[["__scopeId","data-v-183557d2"]]);export{de as default};
