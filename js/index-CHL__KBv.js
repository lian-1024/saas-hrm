import{d as W,a9 as Z,a5 as H,a as K,r as u,Z as X,j as k,o as ee,a2 as g,a3 as p,a4 as m,c as t,u as e,a7 as I,ah as ae,ad as w,G as le}from"./vue-vendor-I_PSXyJa.js";import{u as y,r as oe}from"./index-CI1igBQZ.js";import{D as re}from"./department.service-BmOWA-Yr.js";import{F as v,E as b}from"./employee.service-C0m8ECzY.js";import{Q as te}from"./spin-f7H7F6Je.js";import{u as se}from"./index-YJ2Yz_0y.js";import{D as me}from"./department-Ccp6HD3_.js";import{h as i,F as ne,aj as ie,ak as n,al as E,am as de,an as ue,ao as L,ap as pe,aq as fe,ar as ce,as as ye,at as q,B as ge}from"./antd-vendor-T3zku5__.js";import{_ as ve}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./axios-vendor-cIIFlI1p.js";import"./lodash-vendor-DOy_biNW.js";const be=["src"],Ee={key:1},Oe={class:"ant-upload-text"},he=W({name:"EmployeeDetailPage",__name:"index",setup(De){Z(l=>({"3a285901":"".concat(e(O).paddingLG,"px"),"07b52918":e(O).colorBgContainer}));const{t:a}=H(),{token:O}=se(),C={id:1,workNumber:"",mobile:"",departmentId:1,correctionTime:"",formOfEmployment:v.Formal,staffPhoto:"",timeOfEntry:"",username:""},s=K(C),f=u([]),d=X(),h=u([]),S={span:8},x={span:16},U={username:[{required:!0,message:a("employee.detail.form.rules.username.required"),trigger:"blur"},{min:2,max:4,message:a("employee.detail.form.rules.username.length"),trigger:"blur"}],mobile:[{required:!0,message:a("employee.detail.form.rules.mobile.required"),trigger:"blur"},{pattern:/^1[3-9]\d{9}$/,message:a("employee.detail.form.rules.mobile.format"),trigger:"blur"}],timeOfEntry:[{required:!0,message:a("employee.detail.form.rules.timeOfEntry.required"),trigger:"change"},{type:"date",message:a("employee.detail.form.rules.timeOfEntry.format"),trigger:"change"}],correctionTime:[{required:!0,message:a("employee.detail.form.rules.correctionTime.required"),trigger:"change"},{type:"date",message:a("employee.detail.form.rules.correctionTime.format"),trigger:"change"}],departmentId:[{required:!0,message:a("employee.detail.form.rules.department.required"),trigger:"change"}],formOfEmployment:[{required:!0,message:a("employee.detail.form.rules.formOfEmployment.required"),trigger:"change"}]},D=u(null);function B(l,o){const r=new FileReader;r.addEventListener("load",()=>o(r.result)),r.readAsDataURL(l)}const _=u([]),c=u(!1),F=u(""),T=l=>{if(l.file.status==="uploading"){c.value=!0;return}l.file.status==="done"&&B(l.file.originFileObj,o=>{F.value=o,c.value=!1}),l.file.status==="error"&&(c.value=!1,i.error("upload error"))},N=l=>{const o=l.type==="image/jpeg"||l.type==="image/png";o||i.error(a("employee.detail.upload.error.type"));const r=l.size/1024/1024<2;return r||i.error(a("employee.detail.upload.error.size")),o&&r},{run:P,loading:R}=y(b.getEmployeeDetailById,{manual:!0,onSuccess:({data:l})=>{console.log(l),Object.assign(s,l),f.value=[l.departmentId.toString()]}}),{loading:Y}=y(re.getCompanyDepartmentList,{onSuccess:({data:l})=>{console.log(l),h.value=me.toCascader(l)}}),j=k(()=>R.value||Y.value),{run:M,loading:V}=y(b.updateEmployeeDetail,{manual:!0,onSuccess:()=>{i.success(a("employee.messages.updateSuccess"))},onError:l=>{i.error(l.message||a("employee.messages.updateError"))}}),{run:z,loading:A}=y(b.addEmployee,{manual:!0,onSuccess:()=>{i.success(a("employee.messages.addSuccess")),oe.push("/employee")},onError:l=>{i.error(l.message||a("employee.messages.addError"))}}),G=k(()=>V.value||A.value),Q=[{label:a("employee.table.formalOfEmployment.formal"),value:v.Formal},{label:a("employee.table.formalOfEmployment.informal"),value:v.InFormal}],$=()=>{var o;const l=Number(f.value.slice(-1)[0]);s.departmentId=l,(o=D.value)==null||o.validate().then(r=>{if(d.params.id)M(d.params.id,{...s,departmentId:l});else{const{id:_e,...J}=s;z({...J,departmentId:l})}})};return ee(async()=>{d.params.id&&await P(d.params.id)}),(l,o)=>(p(),g(e(te),{spinning:j.value},{default:m(()=>[t(e(ne),{class:"detail-wrapper h-full",justify:"star"},{default:m(()=>[t(e(ie),{ref_key:"formRef",ref:D,rules:U,class:"detail-form",model:s,"label-col":S,"wrapper-col":x},{default:m(()=>[t(e(n),{label:e(a)("employee.detail.form.fields.username"),name:"username"},{default:m(()=>[t(e(E),{value:s.username,"onUpdate:value":o[0]||(o[0]=r=>s.username=r),placeholder:e(a)("employee.detail.form.placeholder.username")},null,8,["value","placeholder"])]),_:1},8,["label"]),t(e(n),{label:e(a)("employee.detail.form.fields.workNumber"),name:"workNumber"},{default:m(()=>[t(e(E),{value:s.workNumber,"onUpdate:value":o[1]||(o[1]=r=>s.workNumber=r),disabled:""},null,8,["value"])]),_:1},8,["label"]),t(e(n),{label:e(a)("employee.detail.form.fields.mobile"),name:"mobile"},{default:m(()=>[t(e(E),{value:s.mobile,"onUpdate:value":o[2]||(o[2]=r=>s.mobile=r),disabled:!!e(d).params.id},null,8,["value","disabled"])]),_:1},8,["label"]),t(e(n),{label:e(a)("employee.detail.form.fields.department"),name:"departmentId"},{default:m(()=>[t(e(de),{"display-render":({labels:r})=>r.join("-"),placeholder:e(a)("employee.detail.form.placeholder.department"),options:h.value,value:f.value,"onUpdate:value":o[3]||(o[3]=r=>f.value=r)},null,8,["display-render","placeholder","options","value"])]),_:1},8,["label"]),t(e(n),{label:e(a)("employee.detail.form.fields.formOfEmployment"),name:"formOfEmployment"},{default:m(()=>[t(e(ue),{placeholder:e(a)("employee.detail.form.placeholder.formOfEmployment"),value:s.formOfEmployment,"onUpdate:value":o[4]||(o[4]=r=>s.formOfEmployment=r),options:Q},null,8,["placeholder","value"])]),_:1},8,["label"]),t(e(n),{label:e(a)("employee.detail.form.fields.timeOfEntry"),name:"timeOfEntry"},{default:m(()=>[t(e(L),{"value-format":"YYYY-MM-DD",value:s.timeOfEntry,"onUpdate:value":o[5]||(o[5]=r=>s.timeOfEntry=r)},null,8,["value"])]),_:1},8,["label"]),t(e(n),{label:e(a)("employee.detail.form.fields.correctionTime"),name:"correctionTime"},{default:m(()=>[t(e(L),{"value-format":"YYYY-MM-DD",value:s.correctionTime,"onUpdate:value":o[6]||(o[6]=r=>s.correctionTime=r)},null,8,["value"])]),_:1},8,["label"]),t(e(n),{label:e(a)("employee.detail.form.fields.staffPhoto"),name:"staffPhoto"},{default:m(()=>[t(e(pe),{"file-list":_.value,"onUpdate:fileList":o[7]||(o[7]=r=>_.value=r),name:"avatar","list-type":"picture-card",class:"avatar-uploader","show-upload-list":!1,action:"https://www.mocky.io/v2/5cc8019d300000980a055e76","before-upload":N,onChange:T},{default:m(()=>[s.staffPhoto?(p(),I("img",{key:0,class:"w-full h-full",src:s.staffPhoto,alt:"avatar"},null,8,be)):(p(),I("div",Ee,[c.value?(p(),g(e(fe),{key:0})):(p(),g(e(ce),{key:1})),ae("div",Oe,w(e(a)("employee.detail.upload.text")),1)]))]),_:1},8,["file-list"])]),_:1},8,["label"]),t(e(n),null,{default:m(()=>[t(e(ye),null,{default:m(()=>[t(e(q),{span:12}),t(e(q),null,{default:m(()=>[t(e(ge),{type:"primary",onClick:$,loading:G.value},{default:m(()=>[le(w(e(d).params.id?e(a)("employee.detail.form.buttons.update"):e(a)("employee.detail.form.buttons.save")),1)]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})]),_:1},8,["spinning"]))}}),Te=ve(he,[["__scopeId","data-v-c0f21f24"]]);export{Te as default};
