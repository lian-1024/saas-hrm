import{d as O,af as A,a9 as M,u as e,ag as $,r as N,w as h,a5 as B,j as G,a as U,a2 as b,a3 as d,a4 as l,c as n,a7 as V,F as j,aj as q,G as D,ad as P}from"./vue-vendor-I_PSXyJa.js";import{_ as z}from"./modal.vue_vue_type_script_setup_true_lang-BwdYvTp8.js";import{u as H}from"./index-YJ2Yz_0y.js";import{c as J,u as K}from"./index-CI1igBQZ.js";import{b as c}from"./message-B_TRrMgK.js";import{E as Q}from"./employee.service-C0m8ECzY.js";import{h as W,F as _,u as X,aj as f,an as Y,al as Z}from"./antd-vendor-T3zku5__.js";import{_ as ee}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./axios-vendor-cIIFlI1p.js";import"./lodash-vendor-DOy_biNW.js";const ae=O({__name:"mass-notification",props:A({employees:{}},{open:{type:Boolean,default:!1},openModifiers:{}}),emits:["update:open"],setup(v){M(s=>({"1b77d3a6":"".concat(e(p).margin,"px"),"84c22ca2":"".concat(e(p).padding,"px"),"7d9d962b":e(p).colorBorder,"3bf43951":"".concat(e(p).borderRadiusLG,"px")}));const u=$(v,"open"),y=v,{token:p}=H(),{isDark:I}=J(),r=N(y.employees);h([()=>y.employees,()=>u.value],([s,a])=>{a&&(r.value=T(s))});const T=s=>s.map(a=>({id:a.id,username:"@".concat(a.username)})),E=s=>{r.value=r.value.filter(a=>a.id!==s)},{t:o}=B(),x=G(()=>[{label:o("common.message.level.notification"),value:c.NOTIFICATION},{label:o("common.message.level.tips"),value:c.TIPS},{label:o("common.message.level.important"),value:c.IMPORTANT},{label:o("common.message.level.urgent"),value:c.URGENT}]),m=U({type:c.NOTIFICATION,content:""}),i=N(),C={type:[{required:!0,message:o("employee.massNotification.rules.messageLevel")}],content:[{required:!0,message:o("employee.massNotification.rules.content")}]},g=()=>{u.value=!1,i.value&&(i.value.resetFields(),r.value=[])},{run:k,loading:S}=K(Q.massNotification,{manual:!0,onSuccess:()=>{W.success(o("employee.messages.massNotificationSuccess"))},onError:({message:s})=>{s.error(s||o("employee.messages.massNotificationError"))},onFinally:()=>{g()}}),F=async()=>{i.value&&await i.value.validate().then(s=>{k({...m,userIds:r.value.map(a=>a.id)})})},w=()=>{g()},L={span:6},R={span:16};return(s,a)=>(d(),b(e(z),{title:e(o)("employee.massNotification.title"),open:u.value,"onUpdate:open":a[2]||(a[2]=t=>u.value=t),"confirm-loading":e(S),onOk:F,onCancel:w,mask:""},{default:l(()=>[n(e(_),{vertical:""},{default:l(()=>[n(e(_),{wrap:"wrap",gap:"small",class:"mass-selected-employee"},{default:l(()=>[(d(!0),V(j,null,q(r.value,t=>(d(),b(e(X),{color:e(I)?"default":"processing",key:t.id,closable:"",onClose:oe=>E(t.id)},{default:l(()=>[D(P(t.username),1)]),_:2},1032,["color","onClose"]))),128))]),_:1})]),_:1}),n(e(f),{rules:C,ref_key:"formRef",ref:i,model:m,"label-col":L,"wrapper-col":R},{default:l(()=>[n(e(f).Item,{label:e(o)("employee.massNotification.messageLevel"),name:"type"},{default:l(()=>[n(e(Y),{value:m.type,"onUpdate:value":a[0]||(a[0]=t=>m.type=t),options:x.value},null,8,["value","options"])]),_:1},8,["label"]),n(e(f).Item,{label:e(o)("employee.massNotification.content"),name:"content"},{default:l(()=>[n(e(Z).TextArea,{value:m.content,"onUpdate:value":a[1]||(a[1]=t=>m.content=t),placeholder:e(o)("employee.massNotification.rules.content")},null,8,["value","placeholder"])]),_:1},8,["label"])]),_:1},8,["model"])]),_:1},8,["title","open","confirm-loading"]))}}),de=ee(ae,[["__scopeId","data-v-183557d2"]]);export{de as default};
