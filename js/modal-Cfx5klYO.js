import{_ as z}from"./modal.vue_vue_type_script_setup_true_lang-BGdz2b2r.js";import{Q as A}from"./spin-Dif1E5Ka.js";import{u as p}from"./index-Dae1U06w.js";import{D as c}from"./department.service-BCxqcPIw.js";import{d as G,ah as _,a7 as O,r as f,ai as $,j as v,w as H,a4 as J,a5 as K,a6 as d,c as n,u as e,aj as P,G as C}from"./vue-vendor-BX3z0DRI.js";import{h as m,ag as u,ai as b,ak as W,F as X,B as S}from"./antd-vendor-ChGXved8.js";import{_ as Y}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./index-BUvr80Hr.js";import"./axios-vendor-cIIFlI1p.js";import"./lodash-vendor-C1hxrrCz.js";const h={addChild:"addChild",edit:"edit"},Z={class:"department-modal"},ee=G({name:"DepartmentModal",__name:"modal",props:_({type:{},departmentId:{}},{open:{type:Boolean,default:!1},openModifiers:{}}),emits:_(["success"],["update:open"]),setup(D,{expose:k,emit:L}){const{t:a}=O(),s=D,I=f([]),x=$(D,"open"),g=f(),o=f({name:"",code:"",managerId:1,introduce:"",createTime:"",id:0,managerName:"",pid:0}),M=L,q=()=>w[s.type].value,w={[h.addChild]:v(()=>a("department.operations.addChild")),[h.edit]:v(()=>a("department.operations.edit"))},F={name:[{required:!0,message:a("department.form.rules.name.required"),trigger:"blur"},{min:2,max:10,message:a("department.form.rules.name.min"),trigger:"blur"}],code:[{required:!0,message:a("department.form.rules.code.required"),trigger:"blur"},{min:2,max:10,message:a("department.form.rules.code.min"),trigger:"blur"}],managerId:[{required:!0,message:a("department.form.rules.managerId.required"),trigger:"change"}],introduce:[{required:!0,message:a("department.form.rules.introduce.required"),trigger:"blur"},{max:100,message:a("department.form.rules.introduce.max"),trigger:"blur"}]},{run:T,loading:y}=p(c.addDepartment,{manual:!0,onSuccess:t=>{m.success(a("department.operations.operationMessage.addSuccess")),M("success")},onError:t=>{m.error(a("department.operations.operationMessage.addError"))},onFinally:()=>i()}),{loading:B}=p(c.getDepartmentManagerList,{onSuccess:({data:t})=>{I.value=t.map(r=>({label:r.username,value:r.id}))}}),{run:R,loading:N}=p(c.getDepartmentDetail,{manual:!0,onSuccess:({data:t})=>{o.value=t}}),{run:j,loading:E}=p(c.updateDepartment,{manual:!0,onSuccess:t=>{m.success(a("department.operations.operationMessage.editSuccess")),M("success")},onError:t=>{m.error(t.message||a("department.operations.operationMessage.editError"))},onFinally:()=>i()});H(()=>s.departmentId,t=>{t&&s.type===h.edit&&R(t)});const U=()=>{var t;(t=g.value)==null||t.validate().then(async()=>{if(!s.departmentId)return m.error(a("department.operations.operationMessage.selectDepartment"));switch(s.type){case"addChild":const{id:r,createTime:l,managerName:ae,...V}=o.value;T({...V,pid:s.departmentId});break;case"edit":j(o.value);break}})},i=()=>{var t;x.value=!1,(t=g.value)==null||t.resetFields()};k({setFormData:t=>{Object.assign(o.value,t)}});const Q=v(()=>N.value||B.value||E.value||y.value);return(t,r)=>(K(),J(e(z),{width:600,open:x.value,onCancel:i,title:q(),closable:"",mask:"",maskClosable:!1},{footer:d(()=>[n(e(X),{justify:"center"},{default:d(()=>[n(e(S),{type:"primary",onClick:U,loading:e(y)},{default:d(()=>r[4]||(r[4]=[C("确定")])),_:1},8,["loading"]),n(e(S),{onClick:i},{default:d(()=>r[5]||(r[5]=[C("取消")])),_:1})]),_:1})]),default:d(()=>[n(e(A),{spinning:Q.value},{default:d(()=>[P("div",Z,[n(e(u),{ref_key:"formRef",ref:g,layout:"vertical",model:o.value,rules:F},{default:d(()=>[n(e(u).Item,{label:e(a)("department.form.fields.name"),name:"name"},{default:d(()=>[n(e(b),{value:o.value.name,"onUpdate:value":r[0]||(r[0]=l=>o.value.name=l),placeholder:e(a)("department.form.placeholder.name"),maxLength:10,"show-count":""},null,8,["value","placeholder"])]),_:1},8,["label"]),n(e(u).Item,{label:e(a)("department.form.fields.code"),name:"code"},{default:d(()=>[n(e(b),{value:o.value.code,"onUpdate:value":r[1]||(r[1]=l=>o.value.code=l),placeholder:e(a)("department.form.placeholder.code"),maxLength:10,"show-count":""},null,8,["value","placeholder"])]),_:1},8,["label"]),n(e(u).Item,{label:e(a)("department.form.fields.managerId"),name:"managerId"},{default:d(()=>[n(e(W),{placeholder:e(a)("department.form.placeholder.managerId"),value:o.value.managerId,"onUpdate:value":r[2]||(r[2]=l=>o.value.managerId=l),options:I.value},null,8,["placeholder","value","options"])]),_:1},8,["label"]),n(e(u).Item,{label:e(a)("department.form.fields.introduce"),name:"introduce"},{default:d(()=>[n(e(b).TextArea,{value:o.value.introduce,"onUpdate:value":r[3]||(r[3]=l=>o.value.introduce=l),placeholder:e(a)("department.form.placeholder.introduce"),maxLength:100,"auto-size":{minRows:3,maxRows:5},"show-count":""},null,8,["value","placeholder"])]),_:1},8,["label"])]),_:1},8,["model"])])]),_:1},8,["spinning"])]),_:1},8,["open","title"]))}}),pe=Y(ee,[["__scopeId","data-v-4e884d9b"]]);export{pe as default};
