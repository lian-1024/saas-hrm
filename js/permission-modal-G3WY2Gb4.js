import{d as j,ah as k,ab as Q,u as e,ai as A,r as z,a as H,a7 as J,j as h,w as K,a4 as W,a5 as X,a6 as l,c as n,G as I,af as B}from"./vue-vendor-BX3z0DRI.js";import{a as x}from"./permission-CdO8HJj6.js";import{_ as Y}from"./modal.vue_vue_type_script_setup_true_lang-BGdz2b2r.js";import{Q as Z}from"./spin-Dif1E5Ka.js";import{u as ee}from"./index-BUvr80Hr.js";import{u as P}from"./index-BZBl1bBK.js";import{O as g}from"./status-Bkxi8BcS.js";import{h as b,ag as se,ah as v,ai as _,S as ie,F as oe,B as O}from"./antd-vendor-ChGXved8.js";import{_ as re}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./axios-vendor-cIIFlI1p.js";import"./lodash-vendor-C1hxrrCz.js";const y=(u,d)=>u.some(t=>t.name===d?!0:t.children&&y(t.children,d)),ae=(u,d)=>u.some(t=>t.code===d?!0:t.children&&y(t.children,d)),ne=j({__name:"permission-modal",props:k({permissionId:{},isEdit:{type:Boolean},permissionTree:{}},{open:{default:!1},openModifiers:{}}),emits:k(["success"],["update:open"]),setup(u,{emit:d}){Q(o=>({"3b630cd9":"".concat(e(f).marginLG,"px"),d5f2489c:"".concat(e(f).paddingLG,"px"),"42b99349":"".concat(e(f).borderRadiusLG,"px"),"5703ee25":e(f).colorBgContainer}));const t=A(u,"open"),m=u,c=z(),C=d,a=H({id:0,name:"",code:"",description:"",enVisible:0,type:0,pid:1}),{t:s}=J(),w=h(()=>m.isEdit?s("permission.modal.title.edit"):s("permission.modal.title.add")),p=()=>{var o;t.value=!1,(o=c.value)==null||o.resetFields()},F=h(()=>a.enVisible===g.OPENED),V=()=>{a.enVisible=a.enVisible===g.OPENED?g.CLOSED:g.OPENED},L={name:[{required:!0,message:s("permission.modal.form.rules.name.required"),trigger:"blur"},{validator:async(o,i)=>new Promise((r,E)=>(m.isEdit||y(m.permissionTree,i)&&E(s("permission.modal.form.rules.name.exists")),r())),trigger:"blur"},{max:50,min:2,message:s("permission.modal.form.rules.name.length"),trigger:"blur"}],code:[{required:!0,message:s("permission.modal.form.rules.code.required"),trigger:"blur"},{validator:async(o,i)=>new Promise((r,E)=>{if(m.isEdit)return r();ae(m.permissionTree,i)&&E(s("permission.modal.form.rules.code.exists")),r()}),trigger:"blur"},{max:50,min:2,message:s("permission.modal.form.rules.code.length"),trigger:"blur"}]},{run:N,loading:T}=P(x.updatePermission,{manual:!0,onSuccess:()=>{b.success(s("permission.messages.editSuccess")),p(),C("success")},onError:o=>{b.error(o.message||s("permission.messages.editError"))},onFinally:()=>{p()}}),{run:q,loading:D}=P(x.getPermissionById,{manual:!0,onSuccess:({data:o})=>{Object.assign(a,o)}}),{run:M,loading:R}=P(x.addPermission,{manual:!0,onSuccess:()=>{b.success(s("permission.messages.addSuccess")),p(),C("success")},onError:o=>{b.error(o.message||s("permission.messages.addError"))}}),G=async()=>{c.value&&c.value.validate().then(async o=>{if(m.isEdit)await N({...a});else{const{id:i,...r}=a;await M({...r,pid:m.permissionId})}})},S=()=>p(),U=h(()=>R.value||T.value);K([t,()=>m.permissionId],([o,i])=>{m.isEdit&&o&&i&&q(i)});const{token:f}=ee();return(o,i)=>(X(),W(e(Y),{mask:"",open:t.value,"onUpdate:open":i[3]||(i[3]=r=>t.value=r),onCancel:S,title:w.value,closable:""},{footer:l(()=>[n(e(oe),{justify:"center",gap:"small"},{default:l(()=>[n(e(O),{type:"primary",onClick:G,loading:U.value},{default:l(()=>[I(B(e(s)("permission.modal.buttons.confirm")),1)]),_:1},8,["loading"]),n(e(O),{onClick:S},{default:l(()=>[I(B(e(s)("permission.modal.buttons.cancel")),1)]),_:1})]),_:1})]),default:l(()=>[n(e(Z),{spinning:e(D)},{default:l(()=>[n(e(se),{layout:"vertical",ref_key:"formRef",ref:c,class:"permission-form",rules:L,model:a},{default:l(()=>[n(e(v),{label:e(s)("permission.modal.form.fields.name"),name:"name"},{default:l(()=>[n(e(_),{value:a.name,"onUpdate:value":i[0]||(i[0]=r=>a.name=r),placeholder:e(s)("permission.modal.form.placeholder.name")},null,8,["value","placeholder"])]),_:1},8,["label"]),n(e(v),{label:e(s)("permission.modal.form.fields.code"),name:"code"},{default:l(()=>[n(e(_),{value:a.code,"onUpdate:value":i[1]||(i[1]=r=>a.code=r),placeholder:e(s)("permission.modal.form.placeholder.code")},null,8,["value","placeholder"])]),_:1},8,["label"]),n(e(v),{label:e(s)("permission.modal.form.fields.description"),name:"description"},{default:l(()=>[n(e(_),{value:a.description,"onUpdate:value":i[2]||(i[2]=r=>a.description=r),placeholder:e(s)("permission.modal.form.placeholder.description")},null,8,["value","placeholder"])]),_:1},8,["label"]),n(e(v),{label:e(s)("permission.modal.form.fields.enable"),name:"enVisible"},{default:l(()=>[n(e(ie),{checked:F.value,onChange:V},null,8,["checked"])]),_:1},8,["label"])]),_:1},8,["model"])]),_:1},8,["spinning"])]),_:1},8,["open","title"]))}}),Ee=re(ne,[["__scopeId","data-v-a7368adc"]]);export{Ee as default};
